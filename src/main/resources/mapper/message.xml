<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tenco.hobby.repository.interfaces.MessageRepository">

	<insert id="insert">
		insert into message_tb (sender, receiver, message)
		values( #{sender}, #{receiver}, #{message})
	</insert>

	<select id="findByReceiver" resultType="com.tenco.hobby.repository.model.Message">
		select m.*, nickname
		from message_tb as m
		inner join user_tb as u
		on m.sender = u.id
		where m.receiver = #{receiver}
	</select>

	<select id="findBySender" resultType="com.tenco.hobby.repository.model.Message">
		select m.*, nickname
		from message_tb as m
		inner join user_tb as u
		on m.receiver = u.id
		where m.sender = #{sender}
	</select>

	<select id="findByAll" resultType="com.tenco.hobby.repository.model.Message">
		select m.*, us.nickname as 'senderNickname', ur.nickname as 'receiverNickname'
		from message_tb as m
		left join user_tb as us
		on m.sender = us.id
		left join user_tb as ur
		on m.receiver = ur.id
		where m.receiver = #{receiver} or m.sender = #{receiver}

	</select>

</mapper>