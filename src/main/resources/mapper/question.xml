<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tenco.hobby.repository.interfaces.QuestionRepository">

	<!-- 질문 생성 -->
	<insert id="insert">
		insert into question_tb(user_id, content) values(#{userId}, #{content})
	</insert>

	<!-- 수정 -->
	<update id="updateById">
		update question_tb set content = #{content} where id = #{id}
	</update>

	<!-- 삭제 -->
	<delete id="deleteById">
		delete from question_tb where id = #{id}
	</delete>

	<!-- 조회 -->
	<select id="findAll" resultType="com.tenco.hobby.repository.model.QandA">
		select q.*, u.nickname
		from question_tb as q
		inner join user_tb as u
		on q.user_id = u.id
	</select>

	<!-- 글 하나 조회 -->
	<select id="findById" resultType="com.tenco.hobby.repository.model.QandA">
		select q.*, u.nickname
		from question_tb as q
		inner join user_tb as u
		on q.user_id = u.id
		where q.id = #{id}
	</select>
	
	<select id="findQuestionList" resultType="com.tenco.hobby.repository.model.QandA">
		select q.*, u.nickname
		from question_tb as q
		inner join user_tb as u
		on q.user_id = u.id
		where u.id = #{userId}
	</select>
	
	<resultMap type="com.tenco.hobby.repository.model.ResponseQuestion" id="QandA">
		<result column="hobby" property="hobby" />
		<association property="qandA" javaType="com.tenco.hobby.repository.model.QandA">
			<result column="id" property="id"/>
			<result column="user_id" property="userId"/>
			<result column="content" property="content"/>
			<result column="proceed" property="proceed"/>
			<result column="created_at" property="createdAt"/>
		</association>
		<association property="answer" javaType="com.tenco.hobby.repository.model.Answer">
			<result column="id" property="id"/>
			<result column="user_id" property="userId"/>
			<result column="content" property="content"/>
			<result column="question_id" property="questionId"/>
		</association>
	</resultMap>
	<select id="findDetailQuestion" resultMap="QandA">
		select q.*, a.*
		from question_tb as q
		join answer_tb as a
		on q.id = a.question_id
		where q.proceed = 1 and q.id = ${questionId};
	</select>
</mapper>
